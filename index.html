<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µè§†å°ºå¯¸é€‰æ‹©å™¨ - 3Då¢å¼ºç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
            padding: 15px;
        }

        header {
            text-align: center;
            padding: 20px 0;
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #00d4ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p {
            color: #888;
            font-size: 1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
        }

        .control-section {
            margin-bottom: 20px;
        }

        .control-section:last-child {
            margin-bottom: 0;
        }

        .control-section h3 {
            font-size: 0.9rem;
            color: #00d4ff;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-section h3::before {
            content: '';
            width: 3px;
            height: 14px;
            background: #00d4ff;
            border-radius: 2px;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 6px;
        }

        .input-group label small {
            color: #666;
            font-weight: normal;
        }

        .input-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        .input-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7b2ff7);
            cursor: pointer;
        }

        .input-value {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.75rem;
            color: #555;
        }

        .input-value .current {
            color: #00d4ff;
            font-weight: bold;
            font-size: 1rem;
        }

        .tv-sizes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .tv-size-btn {
            padding: 10px 5px;
            border: 2px solid #333;
            border-radius: 10px;
            background: transparent;
            color: #fff;
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tv-size-btn:hover {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }

        .tv-size-btn.active {
            border-color: #00d4ff;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(123, 47, 247, 0.2));
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .tv-size-btn span {
            display: block;
            font-size: 0.65rem;
            color: #666;
            margin-top: 2px;
            font-weight: normal;
        }

        .visualization {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .view-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 800px) {
            .view-container {
                grid-template-columns: 1fr;
            }
        }

        .view-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .view-panel h4 {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-panel h4 .icon {
            font-size: 1.1rem;
        }

        .canvas-wrapper {
            position: relative;
            width: 100%;
            background: #0a0a15;
            border-radius: 12px;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
        }

        .angle-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .angle-badge .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .angle-badge.good .value { color: #4ade80; }
        .angle-badge.warning .value { color: #fbbf24; }
        .angle-badge.bad .value { color: #f87171; }

        .pov-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .pov-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            border-radius: 0;
            background: #0a0a15;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .pov-container.fullscreen .pov-view {
            flex: 1;
            height: auto;
        }

        .pov-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .pov-header h4 {
            font-size: 0.85rem;
            color: #888;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pov-header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .pov-stats {
            display: flex;
            gap: 15px;
            font-size: 0.75rem;
        }

        .pov-stat {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
        }

        .pov-stat .stat-value {
            color: #00d4ff;
            font-weight: bold;
        }

        .fullscreen-btn {
            padding: 6px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .fullscreen-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
        }

        /* 3D POV ä¼˜åŒ–éƒ¨åˆ† */
        .pov-view {
            position: relative;
            width: 100%;
            height: 350px;
            background: linear-gradient(180deg, #1a1a3a 0%, #0f0f25 100%);
            border-radius: 12px;
            overflow: hidden;
            /* å…³é”®: å¼€å¯ 3D é€è§† */
            perspective: 1000px;
        }

        .pov-room {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* åœ°æ¿ */
        .pov-floor {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30%;
            background: linear-gradient(0deg, #151525 0%, transparent 100%);
            /* ç®€å•çš„åœ°æ¿ç½‘æ ¼æ•ˆæœ */
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            perspective-origin: bottom;
            transform-origin: bottom;
            transform: rotateX(10deg); /* è½»å¾®çš„å€¾æ–œå¢åŠ æ·±åº¦æ„Ÿ */
        }

        .pov-wall {
            position: absolute;
            background: linear-gradient(180deg, #2a2a4a 0%, #1f1f3a 100%);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            transition: all 0.4s ease;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.3);
            /* 3D å±æ€§ */
            transform-style: preserve-3d;
        }

        .pov-wall-label {
            position: absolute;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            pointer-events: none;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 3px;
        }

        .pov-wall-width-label {
            bottom: -22px;
            left: 50%;
            transform: translateX(-50%);
        }

        .pov-wall-height-label {
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* ç”µè§† 3D æ•ˆæœå¢å¼º */
        .pov-tv {
            position: absolute;
            background: #080808;
            border-radius: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 3px solid #111;
            z-index: 10;
            transition: all 0.4s ease;
            
            /* å…³é”®: 3D æµ®åŠ¨æ•ˆæœ */
            transform: translateZ(15px); 
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.6), /* è¿œé˜´å½± */
                0 0 0 1px #222; /* è¾¹æ¡†é«˜å…‰ */
        }

        /* å±å¹•åå…‰æ¨¡æ‹Ÿ */
        .pov-tv-screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #252540);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #444;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }
        
        /* ç»ç’ƒè´¨æ„Ÿåå…‰ */
        .pov-tv-screen::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.05) 40%, rgba(255,255,255,0) 50%);
            pointer-events: none;
            z-index: 2;
        }

        .pov-tv-screen video {
            width: 100%;
            height: 100%;
            object-fit: fill;
        }

        .pov-tv-label {
            position: absolute;
            bottom: -28px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #00d4ff, #7b2ff7);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            white-space: nowrap;
            z-index: 11;
        }

        /* äººåƒå‚ç…§ç‰©æ ·å¼ */
        .human-ref {
            position: absolute;
            bottom: 0;
            left: 5%; /* ç«™åœ¨å¢™å·¦ä¾§ */
            width: 0; /* å®½åº¦ç”±JSåŠ¨æ€è®¡ç®—æ¯”ä¾‹ */
            height: 0; /* é«˜åº¦ç”±JSåŠ¨æ€è®¡ç®—æ¯”ä¾‹ */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 250' fill='%23ffffff' opacity='0.3'%3E%3Ccircle cx='50' cy='30' r='20'/%3E%3Cpath d='M20,60 Q50,50 80,60 Q90,70 85,130 L90,240 L60,240 L50,150 L40,240 L10,240 L15,130 Q10,70 20,60 Z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-size: contain;
            background-position: bottom center;
            z-index: 5;
            transition: all 0.4s ease;
            pointer-events: none;
            opacity: 0; /* é»˜è®¤éšè— */
            /* è®©äººåƒç¨å¾®ç¦»å¼€å¢™é¢ä¸€ç‚¹ */
            transform: translateZ(50px);
            filter: drop-shadow(5px 5px 5px rgba(0,0,0,0.5));
        }

        .human-ref.visible {
            opacity: 1;
        }

        .human-label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: rgba(255,255,255,0.4);
            white-space: nowrap;
        }

        /* å¼€å…³æ ·å¼ */
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #888;
            cursor: pointer;
            margin-right: 15px;
        }
        
        .toggle-switch input {
            display: none;
        }

        .toggle-slider {
            width: 36px;
            height: 20px;
            background: #333;
            border-radius: 20px;
            position: relative;
            transition: 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: #00d4ff;
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(16px);
        }

        .pov-crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0.3;
            z-index: 5;
        }

        .pov-crosshair::before,
        .pov-crosshair::after {
            content: '';
            position: absolute;
            background: #fff;
        }

        .pov-crosshair::before {
            width: 1px;
            height: 30px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .pov-crosshair::after {
            width: 30px;
            height: 1px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .info-card .label {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 4px;
        }

        .info-card .value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .info-card .value.good { color: #4ade80; }
        .info-card .value.warning { color: #fbbf24; }
        .info-card .value.bad { color: #f87171; }

        .recommendation {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(123, 47, 247, 0.1));
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .recommendation h4 {
            color: #00d4ff;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .recommendation p {
            color: #bbb;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .recommendation .rec-size {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4ade80;
        }

        .video-controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 12px;
        }

        .video-controls label {
            display: block;
            margin-bottom: 8px;
            color: #888;
            font-size: 0.8rem;
        }

        .video-input-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .video-input-group input[type="text"] {
            flex: 1;
            min-width: 120px;
            padding: 8px 12px;
            border: 1px solid #333;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 0.85rem;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #00d4ff, #7b2ff7);
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.75rem;
            color: #888;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.eye { background: #ff6b6b; }
        .legend-color.tv { background: #4dabf7; }
        .legend-color.fov { background: rgba(0, 212, 255, 0.3); border: 1px solid #00d4ff; }
        .legend-color.optimal { background: rgba(74, 222, 128, 0.3); border: 1px solid #4ade80; }

        .exit-fullscreen-hint {
            display: none;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #888;
            z-index: 100;
        }

        .pov-container.fullscreen .exit-fullscreen-hint {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“º ç”µè§†å°ºå¯¸é€‰æ‹©å™¨</h1>
            <p>ä¸ºæ˜¾ç¤ºæ›´åŠ ç›´è§‚ï¼Œå»ºè®®ä½¿ç”¨ç”µè„‘æ‰“å¼€</p>
        </header>

        <div class="main-content">
            <div class="control-panel">
                <div class="control-section">
                    <h3>æˆ¿é—´å‚æ•°</h3>
                    <div class="input-group">
                        <label>è§‚çœ‹è·ç¦» <small>(æ²™å‘ä¸­å¿ƒåˆ°ç”µè§†å¢™)</small></label>
                        <input type="range" id="distance" min="2" max="5.5" step="0.1" value="3.1">
                        <div class="input-value">
                            <span>2m</span>
                            <span class="current" id="distanceValue">3.1ç±³</span>
                            <span>5.5m</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>ç”µè§†å¢™å®½åº¦</label>
                        <input type="range" id="wallWidth" min="2.5" max="5" step="0.1" value="3.6">
                        <div class="input-value">
                            <span>2.5m</span>
                            <span class="current" id="wallWidthValue">3.6ç±³</span>
                            <span>5m</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>ç”µè§†å¢™é«˜åº¦</label>
                        <input type="range" id="wallHeight" min="2.4" max="3.2" step="0.1" value="2.7">
                        <div class="input-value">
                            <span>2.4m</span>
                            <span class="current" id="wallHeightValue">2.7ç±³</span>
                            <span>3.2m</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>é«˜åº¦è®¾ç½®</h3>
                    <div class="input-group">
                        <label>ç”µè§†ä¸­å¿ƒé«˜åº¦ <small>(ç¦»åœ°)</small></label>
                        <input type="range" id="tvHeight" min="0.8" max="1.5" step="0.05" value="1.1">
                        <div class="input-value">
                            <span>0.8m</span>
                            <span class="current" id="tvHeightValue">1.10ç±³</span>
                            <span>1.5m</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>åå§¿çœ¼ç›é«˜åº¦ <small>(ç¦»åœ°)</small></label>
                        <input type="range" id="eyeHeight" min="0.9" max="1.3" step="0.05" value="1.1">
                        <div class="input-value">
                            <span>0.9m</span>
                            <span class="current" id="eyeHeightValue">1.10ç±³</span>
                            <span>1.3m</span>
                        </div>
                    </div>
                </div>

                <div class="control-section">
                    <h3>ç”µè§†å°ºå¯¸</h3>
                    <div class="tv-sizes">
                        <button class="tv-size-btn" data-size="55">55"<span>122Ã—69</span></button>
                        <button class="tv-size-btn" data-size="65">65"<span>144Ã—81</span></button>
                        <button class="tv-size-btn active" data-size="75">75"<span>166Ã—93</span></button>
                        <button class="tv-size-btn" data-size="85">85"<span>188Ã—106</span></button>
                        <button class="tv-size-btn" data-size="98">98"<span>217Ã—122</span></button>
                        <button class="tv-size-btn" data-size="100">100"<span>221Ã—125</span></button>
                    </div>
                </div>

            <div class="control-section">
                <h3>è§†é¢‘é¢„è§ˆ</h3>
                <div class="video-controls">
                    <label>è§†é¢‘æº (é»˜è®¤åŠ è½½ Big Buck Bunny)</label>
                    <div class="video-input-group">
                        <input type="text" id="videoUrl" value="https://www.w3schools.com/html/mov_bbb.mp4" placeholder="è§†é¢‘URL...">
                        <button class="btn" onclick="loadVideo()">åˆ·æ–°</button>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.75rem; color: #666;">
                        * é»˜è®¤åŠ è½½å…¬ç½‘æµ‹è¯•è§†é¢‘ï¼Œè¯·ç¡®ä¿ç½‘ç»œé€šç•…
                    </div>
                </div>
            </div>
            </div>
            
            <div class="visualization">
                <div class="view-container">
                    <div class="view-panel">
                        <h4><span class="icon">ğŸ”½</span> ä¿¯è§†å›¾ - æ°´å¹³è§†åœºè§’</h4>
                        <div class="canvas-wrapper">
                            <canvas id="topViewCanvas" height="250"></canvas>
                            <div class="angle-badge" id="hAngleBadge">
                                <div>æ°´å¹³è§†åœºè§’</div>
                                <div class="value" id="hAngleValue">30.0Â°</div>
                            </div>
                        </div>
                        <div class="legend">
                            <div class="legend-item"><div class="legend-color eye"></div>çœ¼ç›ä½ç½®</div>
                            <div class="legend-item"><div class="legend-color tv"></div>ç”µè§†</div>
                            <div class="legend-item"><div class="legend-color fov"></div>å®é™…è§†åœºè§’</div>
                            <div class="legend-item"><div class="legend-color optimal"></div>æœ€ä½³èŒƒå›´(30Â°-40Â°)</div>
                        </div>
                    </div>

                    <div class="view-panel">
                        <h4><span class="icon">â—€ï¸</span> ä¾§è§†å›¾ - å‚ç›´è§†åœºè§’</h4>
                        <div class="canvas-wrapper">
                            <canvas id="sideViewCanvas" height="250"></canvas>
                            <div class="angle-badge" id="vAngleBadge">
                                <div>å‚ç›´è§†åœºè§’</div>
                                <div class="value" id="vAngleValue">17.0Â°</div>
                            </div>
                        </div>
                        <div class="legend">
                            <div class="legend-item"><div class="legend-color eye"></div>çœ¼ç›é«˜åº¦</div>
                            <div class="legend-item"><div class="legend-color tv"></div>ç”µè§†ä½ç½®</div>
                            <div class="legend-item"><div class="legend-color fov"></div>å‚ç›´è§†è§’</div>
                        </div>
                    </div>
                </div>

                <div class="pov-container" id="povContainer">
                    <div class="pov-header">
                        <h4><span style="font-size: 1.1rem;">ğŸ‘ï¸</span> ç¬¬ä¸€äººç§°è§†è§’ï¼ˆå¯ç‚¹å‡»å…¨å±æŸ¥çœ‹ï¼‰ </h4>
                        <div class="pov-header-right">
                            
                            <label class="toggle-switch">
                                <input type="checkbox" id="humanToggle" checked>
                                <div class="toggle-slider"></div>
                                <span>äººåƒå‚ç…§ (1.7m)</span>
                            </label>

                            <div class="pov-stats">
                                <div class="pov-stat">
                                    <span>å¢™é¢</span>
                                    <span class="stat-value" id="povWallSize">3.5Ã—2.7m</span>
                                </div>
                                <div class="pov-stat">
                                    <span>ç”µè§†å å¢™å®½</span>
                                    <span class="stat-value" id="povTvRatio">47%</span>
                                </div>
                            </div>
                            <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()">
                                <span id="fullscreenIcon">â›¶</span>
                                <span id="fullscreenText">å…¨å±</span>
                            </button>
                        </div>
                    </div>
                    <div class="pov-view" id="povView">
                        <div class="pov-floor"></div>
                        <div class="pov-wall" id="povWall">
                            <div class="pov-wall-label pov-wall-width-label" id="povWallWidthLabel">3.5m</div>
                            <div class="pov-wall-label pov-wall-height-label" id="povWallHeightLabel">2.7m</div>
                            
                            <div class="human-ref visible" id="humanRef">
                                <div class="human-label">1.7m</div>
                            </div>

                        </div>
                        <div class="pov-tv" id="povTv">
                            <div class="pov-tv-screen" id="povScreen">
                                <span>ğŸ“º æ­£åœ¨åŠ è½½...</span>
                            </div>
                            <div class="pov-tv-label" id="povLabel">75" | 166Ã—93cm</div>
                        </div>
                        <div class="pov-crosshair"></div>
                    </div>
                    <div class="exit-fullscreen-hint">æŒ‰ ESC æˆ–ç‚¹å‡»å…¨å±æŒ‰é’®é€€å‡ºå…¨å±</div>
                </div>

                <div class="info-grid">
                    <div class="info-card">
                        <div class="label">ç”µè§†å°ºå¯¸</div>
                        <div class="value" id="infoSize">75è‹±å¯¸</div>
                    </div>
                    <div class="info-card">
                        <div class="label">å®é™…å°ºå¯¸</div>
                        <div class="value" id="infoDimensions">166Ã—93cm</div>
                    </div>
                    <div class="info-card">
                        <div class="label">è§‚çœ‹è·ç¦»</div>
                        <div class="value" id="infoDistance">3.0ç±³</div>
                    </div>
                    <div class="info-card">
                        <div class="label">æ°´å¹³è§†åœºè§’</div>
                        <div class="value good" id="infoHAngle">30.0Â°</div>
                    </div>
                    <div class="info-card">
                        <div class="label">å‚ç›´è§†åœºè§’</div>
                        <div class="value" id="infoVAngle">17.0Â°</div>
                    </div>
                    <div class="info-card">
                        <div class="label">é«˜åº¦åå·®</div>
                        <div class="value good" id="infoHeightDiff">0cm</div>
                    </div>
                    <div class="info-card">
                        <div class="label">å å¢™é¢å®½åº¦</div>
                        <div class="value" id="infoWallRatio">47%</div>
                    </div>
                </div>

                <div class="recommendation">
                    <h4>ğŸ’¡ ä¸“ä¸šå»ºè®®</h4>
                    <p id="recText"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç”µè§†å°ºå¯¸æ•°æ® (16:9æ¯”ä¾‹ï¼Œå•ä½cm)
        const tvSizes = {
            55: { width: 121.8, height: 68.5, diagonal: 139.7 },
            65: { width: 143.9, height: 80.9, diagonal: 165.1 },
            75: { width: 166.0, height: 93.4, diagonal: 190.5 },
            85: { width: 188.2, height: 105.8, diagonal: 215.9 },
            98: { width: 216.9, height: 122.0, diagonal: 248.9 },
            100: { width: 221.4, height: 124.5, diagonal: 254.0 }
        };

        let currentSize = 75;
        let distance = 3.1;
        let tvHeight = 1.1;
        let eyeHeight = 1.1;
        let wallWidth = 3.6;
        let wallHeight = 2.7;
        let currentVideo = null;
        let isFullscreen = false;

        let topCanvas, sideCanvas, topCtx, sideCtx;

        document.addEventListener('DOMContentLoaded', () => {
            topCanvas = document.getElementById('topViewCanvas');
            sideCanvas = document.getElementById('sideViewCanvas');
            topCtx = topCanvas.getContext('2d');
            sideCtx = sideCanvas.getContext('2d');

            resizeCanvases();
            setupEventListeners();
            updateAll();

            // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ’­æ”¾è§†é¢‘
            loadVideo();

            window.addEventListener('resize', () => {
                resizeCanvases();
                updateAll();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && isFullscreen) {
                    toggleFullscreen();
                }
            });
        });

        function resizeCanvases() {
            const dpr = window.devicePixelRatio || 1;
            
            [topCanvas, sideCanvas].forEach(canvas => {
                const rect = canvas.parentElement.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = 250 * dpr;
                canvas.style.height = '250px';
                canvas.getContext('2d').scale(dpr, dpr);
            });
        }

        function setupEventListeners() {
            document.getElementById('distance').addEventListener('input', (e) => {
                distance = parseFloat(e.target.value);
                document.getElementById('distanceValue').textContent = distance.toFixed(1) + 'ç±³';
                updateAll();
            });

            document.getElementById('wallWidth').addEventListener('input', (e) => {
                wallWidth = parseFloat(e.target.value);
                document.getElementById('wallWidthValue').textContent = wallWidth.toFixed(1) + 'ç±³';
                updateAll();
            });

            document.getElementById('wallHeight').addEventListener('input', (e) => {
                wallHeight = parseFloat(e.target.value);
                document.getElementById('wallHeightValue').textContent = wallHeight.toFixed(1) + 'ç±³';
                updateAll();
            });

            document.getElementById('tvHeight').addEventListener('input', (e) => {
                tvHeight = parseFloat(e.target.value);
                document.getElementById('tvHeightValue').textContent = tvHeight.toFixed(2) + 'ç±³';
                updateAll();
            });

            document.getElementById('eyeHeight').addEventListener('input', (e) => {
                eyeHeight = parseFloat(e.target.value);
                document.getElementById('eyeHeightValue').textContent = eyeHeight.toFixed(2) + 'ç±³';
                updateAll();
            });

            // äººåƒå¼€å…³
            document.getElementById('humanToggle').addEventListener('change', (e) => {
                const humanRef = document.getElementById('humanRef');
                if (e.target.checked) {
                    humanRef.classList.add('visible');
                } else {
                    humanRef.classList.remove('visible');
                }
            });

            document.querySelectorAll('.tv-size-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tv-size-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSize = parseInt(btn.dataset.size);
                    updateAll();
                });
            });
        }

        function toggleFullscreen() {
            const container = document.getElementById('povContainer');
            isFullscreen = !isFullscreen;
            
            if (isFullscreen) {
                container.classList.add('fullscreen');
                document.getElementById('fullscreenIcon').textContent = 'âœ•';
                document.getElementById('fullscreenText').textContent = 'é€€å‡º';
                document.body.style.overflow = 'hidden';
            } else {
                container.classList.remove('fullscreen');
                document.getElementById('fullscreenIcon').textContent = 'â›¶';
                document.getElementById('fullscreenText').textContent = 'å…¨å±';
                document.body.style.overflow = '';
            }
            
            setTimeout(() => updateAll(), 100);
        }

        function updateAll() {
            const tv = tvSizes[currentSize];
            
            const hAngleRad = 2 * Math.atan((tv.width / 100) / (2 * distance));
            const hAngleDeg = hAngleRad * (180 / Math.PI);
            
            const vAngleRad = 2 * Math.atan((tv.height / 100) / (2 * distance));
            const vAngleDeg = vAngleRad * (180 / Math.PI);

            const heightDiff = (tvHeight - eyeHeight) * 100;
            const wallRatio = (tv.width / 100) / wallWidth * 100;

            drawTopView(hAngleDeg);
            drawSideView(vAngleDeg, heightDiff);
            updatePOVView(hAngleDeg, vAngleDeg, heightDiff, wallRatio);
            updateInfoPanel(hAngleDeg, vAngleDeg, heightDiff, wallRatio);
            updateRecommendation(hAngleDeg, vAngleDeg, heightDiff, wallRatio);
        }

        function drawTopView(hAngle) {
            const ctx = topCtx;
            const w = topCanvas.width / (window.devicePixelRatio || 1);
            const h = 250;
            
            ctx.clearRect(0, 0, w, h);

            const eyeX = w * 0.15;
            const eyeY = h * 0.5;
            const scale = (w * 0.7) / 5.5;
            const tvX = eyeX + distance * scale;
            const tvWidth = (tvSizes[currentSize].width / 100) * scale;
            const wallWidthPx = wallWidth * scale;

            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5.5; i += 0.5) {
                const x = eyeX + i * scale;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, h);
                ctx.stroke();
            }

            ctx.fillStyle = '#444';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'center';
            for (let i = 1; i <= 5; i++) {
                const x = eyeX + i * scale;
                ctx.fillText(i + 'm', x, h - 5);
            }

            ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.fillRect(tvX - 5, eyeY - wallWidthPx / 2, 10, wallWidthPx);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 2;
            ctx.strokeRect(tvX - 5, eyeY - wallWidthPx / 2, 10, wallWidthPx);

            const optimalMin = 30 * Math.PI / 180;
            const optimalMax = 40 * Math.PI / 180;
            
            ctx.fillStyle = 'rgba(74, 222, 128, 0.1)';
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(eyeX + Math.cos(optimalMin/2) * w, eyeY - Math.sin(optimalMin/2) * w);
            ctx.lineTo(eyeX + Math.cos(optimalMin/2) * w, eyeY + Math.sin(optimalMin/2) * w);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = 'rgba(74, 222, 128, 0.15)';
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(eyeX + Math.cos(optimalMax/2) * w, eyeY - Math.sin(optimalMax/2) * w);
            ctx.lineTo(eyeX + Math.cos(optimalMax/2) * w, eyeY + Math.sin(optimalMax/2) * w);
            ctx.closePath();
            ctx.fill();

            const angleRad = hAngle * Math.PI / 180;
            ctx.fillStyle = 'rgba(0, 212, 255, 0.2)';
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(tvX, eyeY - tvWidth / 2);
            ctx.lineTo(tvX, eyeY + tvWidth / 2);
            ctx.closePath();
            ctx.fill();

            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(tvX, eyeY - tvWidth / 2);
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(tvX, eyeY + tvWidth / 2);
            ctx.stroke();

            ctx.fillStyle = '#4dabf7';
            ctx.fillRect(tvX - 3, eyeY - tvWidth / 2, 6, tvWidth);

            ctx.beginPath();
            ctx.arc(eyeX, eyeY, 10, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6b6b';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = '#fff';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ‘ï¸', eyeX, eyeY + 4);

            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(eyeX, eyeY, 40, -angleRad/2, angleRad/2);
            ctx.stroke();

            ctx.fillStyle = '#00d4ff';
            ctx.font = 'bold 12px sans-serif';
            ctx.fillText(hAngle.toFixed(1) + 'Â°', eyeX + 55, eyeY + 4);

            ctx.fillStyle = '#888';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('æ²™å‘', eyeX - 15, eyeY + 30);
            ctx.textAlign = 'center';
            ctx.fillText('ç”µè§† ' + currentSize + '"', tvX, eyeY - tvWidth/2 - 10);

            ctx.fillStyle = '#666';
            ctx.font = '10px sans-serif';
            ctx.fillText('å¢™å®½ ' + wallWidth.toFixed(1) + 'm', tvX, eyeY + wallWidthPx/2 + 15);

            updateAngleBadge('hAngleBadge', 'hAngleValue', hAngle);
        }

        function drawSideView(vAngle, heightDiff) {
            const ctx = sideCtx;
            const w = sideCanvas.width / (window.devicePixelRatio || 1);
            const h = 250;
            
            ctx.clearRect(0, 0, w, h);

            const floorY = h * 0.85;
            const scaleH = (h * 0.65) / wallHeight;
            const scaleD = (w * 0.7) / 5.5;
            const eyeX = w * 0.15;
            const tvX = eyeX + distance * scaleD;

            const eyeY = floorY - eyeHeight * scaleH;
            const tvCenterY = floorY - tvHeight * scaleH;
            const tvHeightPx = (tvSizes[currentSize].height / 100) * scaleH;
            const wallHeightPx = wallHeight * scaleH;

            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, floorY, w, h - floorY);

            ctx.fillStyle = 'rgba(255, 255, 255, 0.03)';
            ctx.fillRect(tvX - 15, floorY - wallHeightPx, 30, wallHeightPx);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.lineWidth = 2;
            ctx.strokeRect(tvX - 15, floorY - wallHeightPx, 30, wallHeightPx);

            ctx.strokeStyle = 'rgba(255,255,255,0.05)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5.5; i += 0.5) {
                const x = eyeX + i * scaleD;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, floorY);
                ctx.stroke();
            }
            
            for (let i = 0; i <= wallHeight; i += 0.5) {
                const y = floorY - i * scaleH;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }

            ctx.fillStyle = '#444';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0.5; i <= wallHeight; i += 0.5) {
                const y = floorY - i * scaleH;
                ctx.fillText(i + 'm', w - 5, y + 3);
            }

            ctx.textAlign = 'center';
            for (let i = 1; i <= 5; i++) {
                const x = eyeX + i * scaleD;
                ctx.fillText(i + 'm', x, floorY + 15);
            }

            ctx.fillStyle = 'rgba(0, 212, 255, 0.15)';
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(tvX, tvCenterY - tvHeightPx / 2);
            ctx.lineTo(tvX, tvCenterY + tvHeightPx / 2);
            ctx.closePath();
            ctx.fill();

            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(tvX, tvCenterY - tvHeightPx / 2);
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(tvX, tvCenterY + tvHeightPx / 2);
            ctx.stroke();

            ctx.strokeStyle = 'rgba(255, 107, 107, 0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY);
            ctx.lineTo(tvX + 20, eyeY);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = '#4dabf7';
            ctx.fillRect(tvX - 4, tvCenterY - tvHeightPx / 2, 8, tvHeightPx);

            ctx.beginPath();
            ctx.arc(eyeX, eyeY, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6b6b';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.strokeStyle = 'rgba(255, 107, 107, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(eyeX, eyeY - 5, 12, 0, Math.PI * 2);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(eyeX, eyeY + 7);
            ctx.lineTo(eyeX, floorY - 10);
            ctx.stroke();
            ctx.fillStyle = 'rgba(255, 107, 107, 0.3)';
            ctx.fillRect(eyeX - 25, floorY - 35, 50, 35);

            if (Math.abs(heightDiff) > 5) {
                ctx.strokeStyle = heightDiff > 0 ? '#fbbf24' : '#4ade80';
                ctx.lineWidth = 2;
                ctx.setLineDash([3, 3]);
                ctx.beginPath();
                ctx.moveTo(tvX + 25, eyeY);
                ctx.lineTo(tvX + 25, tvCenterY);
                ctx.stroke();
                ctx.setLineDash([]);

                const arrowY = (eyeY + tvCenterY) / 2;
                ctx.fillStyle = ctx.strokeStyle;
                ctx.font = '10px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText((heightDiff > 0 ? 'â†‘' : 'â†“') + Math.abs(heightDiff).toFixed(0) + 'cm', tvX + 30, arrowY);
            }

            ctx.fillStyle = '#888';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('çœ¼ç› ' + eyeHeight.toFixed(2) + 'm', eyeX, eyeY - 30);
            ctx.fillText('ç”µè§† ' + tvHeight.toFixed(2) + 'm', tvX, tvCenterY - tvHeightPx/2 - 10);

            ctx.fillStyle = '#666';
            ctx.font = '10px sans-serif';
            ctx.fillText('å¢™é«˜ ' + wallHeight.toFixed(1) + 'm', tvX, floorY - wallHeightPx - 8);

            updateAngleBadge('vAngleBadge', 'vAngleValue', vAngle);
        }

        function updateAngleBadge(badgeId, valueId, angle) {
            const badge = document.getElementById(badgeId);
            const value = document.getElementById(valueId);
            
            value.textContent = angle.toFixed(1) + 'Â°';
            
            badge.classList.remove('good', 'warning', 'bad');
            if (badgeId === 'hAngleBadge') {
                if (angle >= 28 && angle <= 40) {
                    badge.classList.add('good');
                } else if (angle >= 20 && angle <= 50) {
                    badge.classList.add('warning');
                } else {
                    badge.classList.add('bad');
                }
            }
        }

        function updatePOVView(hAngle, vAngle, heightDiff, wallRatio) {
            const povView = document.getElementById('povView');
            const povTv = document.getElementById('povTv');
            const povWall = document.getElementById('povWall');
            const povLabel = document.getElementById('povLabel');
            const humanRef = document.getElementById('humanRef');

            const viewWidth = povView.offsetWidth;
            const viewHeight = povView.offsetHeight;

            // è®¡ç®—å¢™é¢çš„çœŸå®å®½é«˜æ¯”
            const wallAspectRatio = wallWidth / wallHeight;

            // å‡è®¾æ°´å¹³è§†é‡ä¸º70åº¦
            const hFOV = 70;
            
            // å¢™é¢æ°´å¹³è§†è§’
            const wallHAngle = 2 * Math.atan((wallWidth / 2) / distance) * (180 / Math.PI);
            
            // å¢™é¢åœ¨è§†é‡ä¸­çš„æ°´å¹³å æ¯”
            const wallWidthPercent = Math.min((wallHAngle / hFOV) * 100, 90);
            
            // å¢™é¢çš„åƒç´ å®½åº¦
            const wallW = viewWidth * wallWidthPercent / 100;
            
            // å¢™é¢çš„åƒç´ é«˜åº¦ï¼ˆä¿æŒçœŸå®å®½é«˜æ¯”ï¼‰
            const wallH = Math.min(wallW / wallAspectRatio, viewHeight * 0.8);
            
            // æ ¹æ®å®é™…é«˜åº¦é‡æ–°è®¡ç®—å®½åº¦ä»¥ä¿æŒæ¯”ä¾‹
            const actualWallW = wallH * wallAspectRatio;

            // å¢™é¢ä½ç½®ï¼ˆå±…ä¸­ï¼‰
            const wallLeft = (viewWidth - actualWallW) / 2;
            const wallTop = (viewHeight - wallH) / 2 - viewHeight * 0.05;

            povWall.style.width = actualWallW + 'px';
            povWall.style.height = wallH + 'px';
            povWall.style.left = wallLeft + 'px';
            povWall.style.top = wallTop + 'px';

            // æ›´æ–°å¢™é¢å°ºå¯¸æ ‡ç­¾
            document.getElementById('povWallWidthLabel').textContent = wallWidth.toFixed(1) + 'm';
            document.getElementById('povWallHeightLabel').textContent = wallHeight.toFixed(1) + 'm';

            // ç”µè§†å°ºå¯¸ - ä¿æŒ16:9æ¯”ä¾‹
            const tv = tvSizes[currentSize];
            const tvAspectRatio = tv.width / tv.height; // çº¦1.78 (16:9)
            
            // ç”µè§†å®½åº¦å å¢™é¢å®½åº¦çš„æ¯”ä¾‹
            const tvWidthRatio = (tv.width / 100) / wallWidth;
            const tvW = actualWallW * tvWidthRatio;
            
            // ç”µè§†é«˜åº¦æŒ‰ç…§çœŸå®16:9æ¯”ä¾‹è®¡ç®—
            const tvH = tvW / tvAspectRatio;

            povTv.style.width = tvW + 'px';
            povTv.style.height = tvH + 'px';

            // ç”µè§†æ°´å¹³å±…ä¸­äºå¢™é¢
            const tvLeft = wallLeft + (actualWallW - tvW) / 2;
            povTv.style.left = tvLeft + 'px';

            // ç”µè§†å‚ç›´ä½ç½®
            const tvCenterFromFloor = tvHeight;
            const tvCenterRatioFromBottom = tvCenterFromFloor / wallHeight;
            const tvCenterYInWall = wallH * (1 - tvCenterRatioFromBottom);
            const tvTop = wallTop + tvCenterYInWall - tvH / 2;

            // æ ¹æ®çœ¼ç›é«˜åº¦è°ƒæ•´è§†é‡åç§»
            const eyeCenterRatio = eyeHeight / wallHeight;
            const viewOffset = (eyeCenterRatio - 0.5) * wallH * 0.2;

            povTv.style.top = Math.max(wallTop, Math.min(tvTop - viewOffset, wallTop + wallH - tvH)) + 'px';

            // æ›´æ–°æ ‡ç­¾
            povLabel.textContent = `${currentSize}" | ${Math.round(tv.width)}Ã—${Math.round(tv.height)}cm`;

            // æ›´æ–°å³ä¸Šè§’ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('povWallSize').textContent = `${wallWidth.toFixed(1)}Ã—${wallHeight.toFixed(1)}m`;
            document.getElementById('povTvRatio').textContent = wallRatio.toFixed(0) + '%';

            // æ ¸å¿ƒåŠŸèƒ½ï¼šäººåƒå‚ç…§è®¡ç®—
            // é€»è¾‘ï¼š1.7m åœ¨å½“å‰å¢™é«˜(wallHeight)å’Œå¢™åƒç´ é«˜(wallH)ä¸‹çš„åƒç´ å€¼
            const humanHeightMeters = 1.7;
            const humanHeightPx = (humanHeightMeters / wallHeight) * wallH;
            const humanWidthPx = humanHeightPx * 0.4; // å‡è®¾å®½é«˜æ¯” 0.4

            humanRef.style.height = humanHeightPx + 'px';
            humanRef.style.width = humanWidthPx + 'px';
        }

        function updateInfoPanel(hAngle, vAngle, heightDiff, wallRatio) {
            const tv = tvSizes[currentSize];

            document.getElementById('infoSize').textContent = currentSize + 'è‹±å¯¸';
            document.getElementById('infoDimensions').textContent = 
                `${Math.round(tv.width)}Ã—${Math.round(tv.height)}cm`;
            document.getElementById('infoDistance').textContent = distance.toFixed(1) + 'ç±³';

            const hAngleEl = document.getElementById('infoHAngle');
            hAngleEl.textContent = hAngle.toFixed(1) + 'Â°';
            hAngleEl.className = 'value';
            if (hAngle >= 28 && hAngle <= 40) {
                hAngleEl.classList.add('good');
            } else if (hAngle >= 20 && hAngle <= 50) {
                hAngleEl.classList.add('warning');
            } else {
                hAngleEl.classList.add('bad');
            }

            document.getElementById('infoVAngle').textContent = vAngle.toFixed(1) + 'Â°';

            const heightEl = document.getElementById('infoHeightDiff');
            const absHeightDiff = Math.abs(heightDiff);
            heightEl.textContent = (heightDiff >= 0 ? '+' : '') + heightDiff.toFixed(0) + 'cm';
            heightEl.className = 'value';
            if (absHeightDiff <= 10) {
                heightEl.classList.add('good');
            } else if (absHeightDiff <= 25) {
                heightEl.classList.add('warning');
            } else {
                heightEl.classList.add('bad');
            }

            const ratioEl = document.getElementById('infoWallRatio');
            ratioEl.textContent = wallRatio.toFixed(0) + '%';
            ratioEl.className = 'value';
            if (wallRatio >= 40 && wallRatio <= 60) {
                ratioEl.classList.add('good');
            } else if (wallRatio >= 30 && wallRatio <= 70) {
                ratioEl.classList.add('warning');
            } else {
                ratioEl.classList.add('bad');
            }
        }

        function updateRecommendation(hAngle, vAngle, heightDiff, wallRatio) {
            const targetAngle = 32 * Math.PI / 180;
            const recommendedWidth = 2 * distance * Math.tan(targetAngle / 2) * 100;

            let recommendedSize = 75;
            let minDiff = Infinity;

            Object.entries(tvSizes).forEach(([size, dims]) => {
                const diff = Math.abs(dims.width - recommendedWidth);
                if (diff < minDiff) {
                    minDiff = diff;
                    recommendedSize = parseInt(size);
                }
            });

            let text = `æ ¹æ®æ‚¨ <strong>${distance.toFixed(1)}ç±³</strong> çš„è§‚çœ‹è·ç¦»ï¼Œ`;

            const sizes = Object.keys(tvSizes).map(Number).sort((a, b) => a - b);
            const recIndex = sizes.indexOf(recommendedSize);
            const minRec = sizes[Math.max(0, recIndex)];
            const maxRec = sizes[Math.min(sizes.length - 1, recIndex + 1)];

            text += `æ¨èé€‰æ‹© <span class="rec-size">${minRec}-${maxRec}è‹±å¯¸</span> çš„ç”µè§†ã€‚`;

            if (hAngle >= 30 && hAngle <= 40) {
                text += ` å½“å‰é€‰æ‹©çš„ <strong>${currentSize}è‹±å¯¸</strong> éå¸¸åˆé€‚ï¼`;
                text += ` ${hAngle.toFixed(1)}Â° çš„æ°´å¹³è§†åœºè§’è¾¾åˆ°äº†THXæ¨èçš„ç”µå½±é™¢çº§åˆ«ä½“éªŒã€‚`;
            } else if (hAngle >= 25 && hAngle < 30) {
                text += ` å½“å‰ <strong>${currentSize}è‹±å¯¸</strong> ç•¥å°ï¼Œå¯è€ƒè™‘æ›´å¤§ä¸€æ¡£ä»¥è·å¾—æ›´æ²‰æµ¸çš„ä½“éªŒã€‚`;
            } else if (hAngle > 40 && hAngle <= 50) {
                text += ` å½“å‰ <strong>${currentSize}è‹±å¯¸</strong> ç¨å¤§ï¼Œåè¿‘æ—¶å¯èƒ½éœ€è¦è½¬åŠ¨å¤´éƒ¨ï¼Œä½†æ²‰æµ¸æ„Ÿä¼šæ›´å¼ºã€‚`;
            } else if (hAngle < 25) {
                text += ` å½“å‰ <strong>${currentSize}è‹±å¯¸</strong> åå°ï¼Œå»ºè®®é€‰æ‹©æ›´å¤§å°ºå¯¸ä»¥æå‡è§‚å½±ä½“éªŒã€‚`;
            } else {
                text += ` å½“å‰ <strong>${currentSize}è‹±å¯¸</strong> è¿‡å¤§ï¼Œå¯èƒ½é€ æˆè§‚çœ‹ç–²åŠ³ã€‚`;
            }

            if (wallRatio > 70) {
                text += ` âš ï¸ ç”µè§†å å¢™é¢å®½åº¦ ${wallRatio.toFixed(0)}%ï¼Œè§†è§‰ä¸Šå¯èƒ½æ˜¾å¾—è¿‡äºæ‹¥æŒ¤ï¼Œå»ºè®®è€ƒè™‘å°ä¸€å·çš„ç”µè§†æˆ–æ›´å®½çš„ç”µè§†å¢™ã€‚`;
            } else if (wallRatio < 35) {
                text += ` ç”µè§†å å¢™é¢ ${wallRatio.toFixed(0)}%ï¼Œå¢™é¢ç©ºé—´å……è£•ï¼Œå¯ä»¥è€ƒè™‘æ›´å¤§å°ºå¯¸çš„ç”µè§†ã€‚`;
            } else if (wallRatio >= 40 && wallRatio <= 55) {
                text += ` âœ… ç”µè§†å å¢™é¢ ${wallRatio.toFixed(0)}%ï¼Œæ¯”ä¾‹åè°ƒç¾è§‚ã€‚`;
            }

            const absHeightDiff = Math.abs(heightDiff);
            if (absHeightDiff > 20) {
                if (heightDiff > 0) {
                    text += ` âš ï¸ ç”µè§†ä¸­å¿ƒé«˜äºçœ¼ç› ${absHeightDiff.toFixed(0)}cmï¼Œé•¿æ—¶é—´è§‚çœ‹å¯èƒ½é€ æˆé¢ˆéƒ¨ç–²åŠ³ï¼Œå»ºè®®é™ä½ç”µè§†å®‰è£…é«˜åº¦ã€‚`;
                } else {
                    text += ` âš ï¸ ç”µè§†ä¸­å¿ƒä½äºçœ¼ç› ${absHeightDiff.toFixed(0)}cmï¼Œå»ºè®®é€‚å½“æé«˜ç”µè§†å®‰è£…ä½ç½®ã€‚`;
                }
            } else if (absHeightDiff <= 10) {
                text += ` âœ… ç”µè§†é«˜åº¦ä¸çœ¼ç›å¹³é½ï¼Œè§‚çœ‹å§¿åŠ¿èˆ’é€‚ã€‚`;
            }

            document.getElementById('recText').innerHTML = text;
        }

        function loadVideo() {
            const url = document.getElementById('videoUrl').value.trim();
            if (!url) {
                alert('è¯·è¾“å…¥è§†é¢‘URL');
                return;
            }
            playVideo(url);
        }

        function playVideo(url) {
            const screen = document.getElementById('povScreen');

            if (currentVideo) {
                currentVideo.pause();
                if (currentVideo.src.startsWith('blob:')) {
                    URL.revokeObjectURL(currentVideo.src);
                }
            }

            screen.innerHTML = `
                <video id="povVideo" autoplay loop muted playsinline>
                    <source src="${url}" type="video/mp4">
                </video>
            `;

            currentVideo = document.getElementById('povVideo');
            
            // ç‚¹å‡»åˆ‡æ¢é™éŸ³/æ’­æ”¾
            currentVideo.addEventListener('click', () => {
                if (currentVideo.muted) {
                    currentVideo.muted = false;
                }
                if (currentVideo.paused) {
                    currentVideo.play();
                } else {
                    currentVideo.pause();
                }
            });

            currentVideo.addEventListener('error', () => {
                screen.innerHTML = '<span>âš ï¸ è§†é¢‘åŠ è½½å¤±è´¥</span>';
            });
        }
    </script>
</body>
</html>